<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="RSE at Sheffield">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RSE at Sheffield</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href="http://rse.shef.ac.uk/blog/">
<link rel="next" href="index-3.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://rse.shef.ac.uk/">

                <span id="blog-title">RSE at Sheffield</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../activities">What we do</a>
                </li>
<li>
<a href="../training">Training</a>
                </li>
<li>
<a href="../blog">Blog</a>
                </li>
<li>
<a href="../community">Community</a>
                </li>
<li>
<a href="../resources">Resources</a>
                </li>
<li>
<a href="../testimonials">Testimonials</a>
                </li>
<li>
<a href="../contact">Contact Us</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="tmux-intro/" class="u-url">tmux: remote terminal management and multiplexing</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="../authors/will-furnass/">Will Furnass</a>
            </span></p>
            <p class="dateline"><a href="tmux-intro/" rel="bookmark"><time class="published dt-published" datetime="2017-06-15T12:53:04+01:00" title="2017-06-15 12:53">2017-06-15 12:53</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Today we have a guide to 'terminal multiplexing' including
suggestions on how to use it on computer clusters such as
<a class="reference external" href="http://docs.hpc.shef.ac.uk/">ShARC and Iceberg</a>.</p>
<hr class="docutils">
<div class="section" id="have-you-ever">
<h2>Have you ever?</h2>
<ul class="simple">
<li>Started a process (such as a compilation or application install) over
SSH only to realise that it's taking far longer than you expected and
you need to shut down your laptop to go to a meeting, which you know
will therefore <strong>kill both the SSH connection and your process</strong>?</li>
<li>Been in a cafe with flakey wifi and had a remote process hang or
possibly die due to an unstable SSH connection?</li>
<li>Accidentally closed a window with a SSH session running in it and
really regretted it?</li>
<li>Wanted to be able to switch between multiple terminal sessions on a
remote machine without having to establish a SSH connection per
session?</li>
<li>Wanted to be able to have multiple terminals visible at once so you
can say edit source code in one terminal whilst keeping compilation
errors visible in another?</li>
<li>Wanted a nicer way to copy and paste between remote terminal
sessions?</li>
</ul>
<p>If the answer to any of these is "yes" then
<strong>terminal multiplexing</strong> may help!</p>
<div class="figure">
<img alt="Making remote Linux/Unix machines easier to administer/use!" src="../images/tmux-intro/intro.png">
</div>
<hr class="docutils">
<p>First, we need to delve a little deeper into some of the problems we are trying to solve.</p>
</div>
<div class="section" id="why-do-my-remote-processes-die-when-my-ssh-connection-dies-hangs">
<h2>Why do my remote processes die when my SSH connection dies/hangs?</h2>
<p>(<em>Skip over this section if you want!</em>)</p>
<p>Every process
(bar the <tt class="docutils literal">systemd</tt> process or <tt class="docutils literal">init</tt> process with a process ID of 1)
has a parent process.
If a process is sent a signal telling it to cleanly terminate
(or <a class="reference external" href="https://en.wikipedia.org/wiki/SIGHUP">'hang up'</a>)
then typically its child processes will be told to do the same.</p>
<p>When you SSH to a remote machine,
the SSH service on that machine creates
a shell for you within which you can run commands.</p>
<p>To illustrate, here I logged into a server and
used the <tt class="docutils literal">pstree</tt> program to view the tree of
child-parent relationships between processes.
Notice in the excerpt shown below that the SSH service (<tt class="docutils literal">sshd</tt>) has
<em>spawned</em> a (bash) shell process for my SSH session,
which in turn has spawned my <tt class="docutils literal">pstree</tt> process:</p>
<pre class="literal-block">
[will@acai ~]$ ssh sharc
...
[will@sharc-login1 ~]$ pstree -a
systemd --switched-root --system --deserialize 21
...
  ├─sshd -D
  │   └─sshd
  │       └─sshd
  │           └─bash
  │               └─pstree -a
...
</pre>
<p>So if the SSH service decides that your connection has timed out then
it will send a signal to <tt class="docutils literal">bash</tt> process were to die then
any child processes started by that <tt class="docutils literal">bash</tt> process would also die.</p>
<p>If the remote servers you work with are
primarily High-Performance Computing (HPC) clusters
running scheduling software such as Grid Engine
then you have a simple, robust way of ensuring that
the sucess of your processes doesn't depend on
the reliability of your connection to the clusters:
<strong>submit your work to the scheduler as batch jobs</strong>.
There are many other benefits to submitting batch jobs over using interactive sessions
when using such clusters but we won't go into those here.</p>
<p>However, what do you do when there is no HPC-style scheduling software availble?</p>
<ul class="simple">
<li>You could run batch jobs using much simpler schedulers such as
<a class="reference external" href="https://en.wikipedia.org/wiki/At_(Unix)">at</a> for one-off tasks or
<a class="reference external" href="https://en.wikipedia.org/wiki/Cron">cron</a> or <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.timer.html">systemd
Timers</a>
for periodic tasks.</li>
<li>You could prefix your command with
<a class="reference external" href="https://en.wikipedia.org/wiki/Nohup">nohup</a> (<em>no hang up</em>) to
ensure it continues running if the parent process tells it to <em>hang
up</em>.</li>
</ul>
<p>Neither of these allow you to easily <strong>return to interactive sessions</strong> though.
For that we need terminal multiplexers.</p>
</div>
<div class="section" id="a-brief-guide-to-the-tmux-terminal-multiplexer">
<h2>A brief guide to the tmux Terminal Multiplexer</h2>
<div class="section" id="detaching-and-reattaching-to-sessions">
<h3>Detaching and reattaching to sessions</h3>
<p>Terminal Multiplexer programs like
<a class="reference external" href="https://www.gnu.org/software/screen/">GNU Screen</a> and
<a class="reference external" href="https://tmux.github.io/">tmux</a>
solve this problem by:</p>
<ol class="arabic simple">
<li>Starting up a <strong>server process on-demand</strong>, which then spawns a
shell. The server process is configured not to respond when being
told to <em>hang up</em> so <strong>will persist</strong> if is started over a SSH
connection that subsequently hangs/dies.</li>
<li>Starting up a <strong>client process</strong> that allows you to connect to that
server and interact with the shell session it has started</li>
<li>Using key-bindings to stop the client process and <strong>detatch</strong> from
the server process.</li>
<li>Using command-line arguments to allow a client process to
<strong>(re)connect to an existing server process</strong>
</li>
</ol>
<div class="section" id="demo-1">
<h4>Demo 1</h4>
<p>Here we look at demonstrating the above using <strong>tmux</strong>.
I recommend tmux over GNU Screen as
the documentation is clearer and
it makes fewer references to legacy infrastructure.
Plus, it is easier to google for it!
However, it may use more memory (true for older versions).</p>
<p>Let's create and attach to a new tmux session,
start a long-running command in it then
detach and reattach to the session:</p>
<embed><video controls><source src="../images/tmux-intro/reattach.webm" type="video/webm">
  Your browser does not support the video tag.
</source></video></embed><p>Used keys:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top"><tr class="field">
<th class="field-name">&lt;prefix&gt; d:</th>
<td class="field-body">detatch</td>
</tr></tbody>
</table>
<p>where <strong>&lt;prefix&gt;</strong> is <strong>Control</strong> and <strong>b</strong> by default.
Here <strong>&lt;prefix&gt; d</strong> means press <strong>Control</strong> and <strong>b</strong> then
release that key combination before pressing <strong>d</strong>.</p>
<p>In this case we started tmux on the local machine.
tmux is much more useful though when you
start it on a remote machine <strong>after connecting via ssh</strong>.</p>
</div>
</div>
<div class="section" id="windows-like-tabs">
<h3>Windows (like tabs)</h3>
<p>What else can we do with terminal multiplexers?
Well, as the name implies,
they can be used to view and control multiple virtual consoles from one session.</p>
<p>A given tmux session can have multiple windows,
each of which can contain multiple panes,
each of which is a virtual console!</p>
<div class="section" id="demo-2">
<h4>Demo 2</h4>
<p>Here's a demonstration of creating, renaming, switching and deleting tmux windows:</p>
<embed><video controls><source src="../images/tmux-intro/windows.webm" type="video/webm">
  Your browser does not support the video tag.
</source></video></embed><p>Used keys:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top">
<tr class="field">
<th class="field-name">&lt;prefix&gt; ,:</th>
<td class="field-body">rename a window</td>
</tr>
<tr class="field">
<th class="field-name">&lt;prefix&gt; c:</th>
<td class="field-body">create a new window</td>
</tr>
<tr class="field">
<th class="field-name">&lt;prefix&gt; n:</th>
<td class="field-body">switch to next window</td>
</tr>
<tr class="field">
<th class="field-name">&lt;prefix&gt; p:</th>
<td class="field-body">switch to previous window</td>
</tr>
<tr class="field">
<th class="field-name">&lt;prefix&gt; x:</th>
<td class="field-body">delete current window (actually deletes the current <strong>pane</strong> in the window but will also delete the window if it contains only one pane)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="dividing-up-windows-into-panes">
<h3>Dividing up Windows into Panes</h3>
<p>Now let's look at creating, switching and deleting panes <em>within</em> a window:</p>
<embed><video controls><source src="../images/tmux-intro/panes.webm" type="video/webm">
  Your browser does not support the video tag.
</source></video></embed><p>Used keys:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top">
<tr class="field">
<th class="field-name">&lt;prefix&gt; %:</th>
<td class="field-body">split the active window vertically</td>
</tr>
<tr class="field">
<th class="field-name">&lt;prefix&gt; ":</th>
<td class="field-body">split the active window horizontally</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">&lt;prefix&gt; Up or Down or Left or Right:</th></tr>
<tr class="field">
<td> </td>
<td class="field-body">switch to pane in that direction</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="scrolling-backwards">
<h3>Scrolling backwards</h3>
<p>You can scroll back up through the terminal history of the current pane/window using:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">&lt;prefix&gt; Page Up:</th></tr>
<tr class="field">
<td> </td>
<td class="field-body">scroll back through terminal history</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="copying-and-pasting">
<h3>Copying and pasting</h3>
<p>If you have multiple panes side-by-side then attempt to copy text using the mouse, you'll copy lines of characters that span <em>all</em> panes, which is almost certainly not going to be what you want.
Instead you can</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top"><tr class="field">
<th class="field-name">&lt;prefix&gt; z:</th>
<td class="field-body">toggle the maximisation of the current pane</td>
</tr></tbody>
</table>
<p>then copy the text you want.</p>
<p>Alternively, if you want to copy and paste between tmux panes/windows you can</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top"><tr class="field">
<th class="field-name">&lt;prefix&gt; [:</th>
<td class="field-body">enter copy mode</td>
</tr></tbody>
</table>
<p>move the cursor using the arrow keys to where you want to start copying then</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top"><tr class="field">
<th class="field-name">space:</th>
<td class="field-body">(in copy mode) mark start of section to copy</td>
</tr></tbody>
</table>
<p>move the cursor keys to the end of the section you want to copy then</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top"><tr class="field">
<th class="field-name">enter:</th>
<td class="field-body">(in copy mode) mark end of section to copy and exit copy mode</td>
</tr></tbody>
</table>
<p>You can then move to another pane/window and press</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top"><tr class="field">
<th class="field-name">&lt;prefix&gt; ]:</th>
<td class="field-body">paste copied text</td>
</tr></tbody>
</table>
<p>I find this mechanism very useful.</p>
</div>
<div class="section" id="and-there-s-more">
<h3>And there's more</h3>
<p>Things not covered in detail here include:</p>
<ul class="simple">
<li>The ability to <a class="reference external" href="https://wiki.archlinux.org/index.php/tmux#Configuration">customise much behaviour and all keybindings</a>
(here's <a class="reference external" href="https://github.com/willfurnass/dotfiles/blob/master/tmux/.tmux.conf">my config file</a>)</li>
<li>The <a class="reference external" href="https://github.com/tmux-plugins/tpm">tpm</a> plugin system
(including the awesome <a class="reference external" href="https://github.com/Morantron/tmux-fingers">tmux fingers</a> plugin for
intelligently copying key info (e.g. IP addresses) from the output of standard Unix utilities).</li>
<li><a class="reference external" href="https://www.howtoforge.com/sharing-terminal-sessions-with-tmux-and-screen">Sharing a session with another user</a></li>
</ul>
</div>
</div>
<div class="section" id="using-tmux-on-hpc-clusters">
<h2>Using tmux on HPC clusters</h2>
<p>Terminal Multiplexers can be useful if doing <a class="reference external" href="http://docs.hpc.shef.ac.uk/en/latest/hpc/scheduler/sge.html#interactive-sessions)">interactive work</a>
on a <a class="reference external" href="https://en.wikipedia.org/wiki/Supercomputer">HPC</a> cluster such as the University of Sheffield clusters <a class="reference external" href="http://docs.hpc.shef.ac.uk/">ShARC and Iceberg</a>
(assuming that you don't need a <a class="reference external" href="https://en.wikipedia.org/wiki/Graphical_user_interface">GUI</a>).</p>
<p>On ShARC and Iceberg can:</p>
<ol class="arabic simple">
<li>Start a tmux or GNU Screen session on a login node;</li>
<li>Start an interactive job using <a class="reference external" href="http://docs.hpc.shef.ac.uk/en/latest/hpc/scheduler/sge.html">qrshx or qrsh</a>;</li>
<li>Disconnect and reconnect from the tmux/Screen session (either deliberately or due an issue with the SSH connection to the cluster);</li>
<li>Create additional windows/panes on the login node for editing files, starting additional interactive jobs etc, watching log files.</li>
</ol>
<p>Starting tmux on worker nodes is also useful if you want to have multiple windows/panes on a worker node <em>but</em>
less useful if you want to disconnect/reconnect from/to a session as if you run qrsh a second time you cannot
guarantee that you will be give an interactive job on on the node you started the tmux session from.</p>
<p>However, note that you can have nested tmux sessions
(with <strong>&lt;prefix&gt;&lt;prefix&gt; &lt;key&gt;</strong> used to send tmux commands to the 'inner' tmux session).</p>
<p><strong>Warning</strong>: many clusters have multiple login nodes for redundancy,
with only one being the default active login node at any given time.
If the active login node requires maintenance then logged-in users may be booted off
and long-running processes may be terminated
(before the system administrator makes a 'standby' login node the currently active one).
Under such circumstances your tmux/Screen session may be killed.</p>
<div class="section" id="being-a-good-hpc-citizen">
<h3>Being a good HPC citizen</h3>
<p>Your interactive job (on a cluster worker node) will be terminated by the cluster's <em>Grid Engine</em> job scheduler after a fixed amount of time (the default is 8 hours)
but your tmux/Screen session was started on a login node so is outside the control of the cluster and
will keep running indefinitely unless you kill it.</p>
<p>Each tmux/Screen session requires memory on the login node (which is used by all users) so to be a good HPC citizen you should:</p>
<ul class="simple">
<li>
<strong>Kill your tmux/Screen session when no longer needed</strong> (tmux/Screen will exit when you close all windows)</li>
<li><strong>Only start as many tmux/Screen sessions on the login node as you need (ideally 1)</strong></li>
<li>
<strong>Exit your interactive Grid Engine job</strong> (on a worker node) <strong>if no longer needed</strong> as then others can make use of the resources you had been using on this node.</li>
</ul>
<p><strong>Tip</strong>: with tmux you can ensure that you either reconnect to an existing session (with a given name) if it already exists <em>or</em> create a new session using:</p>
<pre class="literal-block">
tmux new-session -A -s mysession
</pre>
<p>This should help avoid accidentally creating more than one tmux session.</p>
<hr class="docutils">
<p>NB the recordings of terminal sessions shown were created using <a class="reference external" href="http://0xcc.net/ttyrec/index.html.en">ttyrec</a> and <a class="reference external" href="https://github.com/icholy/ttygif">ttygif</a>
then converted to <a class="reference external" href="http://www.webmproject.org/">.webm</a> videos using <a class="reference external" href="http://ffmpeg.org/">ffmpeg</a>.</p>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="soft-carp-at-tuos/" class="u-url">Software Carpentry and Data Carpentry at the University of Sheffield!</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="../authors/will-furnass/">Will Furnass</a>
            </span></p>
            <p class="dateline"><a href="soft-carp-at-tuos/" rel="bookmark"><time class="published dt-published" datetime="2017-06-08T12:00:00Z" title="2017-06-08 12:00">2017-06-08 12:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>The University of Sheffield is now a Software Carpentry Partner Organisation, allowing the Research Software Engineering and Library teams to start organising <em>Software Carpentry</em> and <em>Data Carpentry</em> workshops.  These are designed to help researchers develop the programming, automation and data management skills needed to support their research.  <strong>Workshop dates are to be announced shortly.</strong></p>
<hr>
<p><strong>Edit</strong>: </p>
<p>Our first Software Carpentry workshop is scheduled for 16th and 17th August!  More details to follow.</p>
<hr>
<p><img alt="Software Carpentry and Data Carpentry logos" src="../images/sc-dc-logos.png"></p>
<h3>Addressing the training needs of researchers with regards to programming</h3>
<p>As more researchers realise they can produce better quality research more quickly if
they have some coding and data management skills under their belts
universities will need to ensure that training in these areas is accessible to those that need it.</p>
<p>Academic institutions will most likely already have courses for teaching highly-specialist subjects
(such as how to use the local <a href="http://docs.hpc.shef.ac.uk/en/latest/">HPC cluster</a>)
but for the more generic aspects of research software development and data management
there are several obvious choices:</p>
<ul>
<li>Develop and deliver bespoke materials;</li>
<li>Buy in to commercial training packages;</li>
<li>Point researchers towards free online resources;</li>
</ul>
<p>However, there is also a fourth option:
team up with the <a href="https://software-carpentry.org/">Software Carpentry</a> (SC) and
<a href="http://www.datacarpentry.org/">Data Carpentry</a> (DC) not-for-profit organisations
to deliver on-site, interative workshops based on open-source materials that have been
refined by a large community of SC and DC instructors.</p>
<h3>Software whatywhaty?</h3>
<p><strong>Software Carpentry</strong> has developed <a href="https://software-carpentry.org/lessons/">discipline-agnostic workshop material</a> on:</p>
<ul>
<li>programming with Python, R or MATLAB;</li>
<li>using databases and <a href="https://en.wikipedia.org/wiki/SQL">SQL</a>;</li>
<li>the <a href="https://en.wikipedia.org/wiki/Unix_shell">UNIX shell</a>;</li>
<li>
<a href="https://en.wikipedia.org/wiki/Version_control">version control</a> with git or mercurial;</li>
<li>automation using <a href="https://en.wikipedia.org/wiki/Make_(software)">Make</a>.</li>
</ul>
<p><a href="http://www.datacarpentry.org/lessons/"><strong>Data Carpentry</strong> lessons</a> look at data management and processing within the context of a specific domain (such as ecology or genomics), focussing on areas such as:</p>
<ul>
<li>the command line;</li>
<li>data cleaning and filtering using <a href="http://openrefine.org/">OpenRefine</a>;</li>
<li>data processing and visualisation with Python or R;</li>
<li>cloud computing</li>
<li><a href="https://en.wikipedia.org/wiki/Geographic_information_system">GIS</a></li>
</ul>
<h3>What form do the workshops take?</h3>
<p>The Software and Data Carpentry organisations ask that accredited instructors delivering 'branded' workshops adopt a fairly progressive teaching style:</p>
<ul>
<li>Workshops typically last two days and include four lessons (e.g. the unix shell, Python, version control and databases).</li>
<li>There's lots of <em>live coding</em>: the instructor and students gather together in a room with laptops and a projector and all present go through a number of examples interactively.  Students use their own laptops to ensure that they're able to continue where they left off at the end of a workshop.  Instructors can and do make mistakes when doing live coding; students can then learn from these mistakes and may grow in confidence on learning that pros make mistakes too.</li>
<li>Instructors try to elicit responses from students and use quizes to gauge comprehension and keep students focussed.</li>
<li>Software Carpentry has a <a href="https://software-carpentry.org/conduct/">code of conduct</a> and tries to ensure that all lessons delivered under its banner are as <a href="https://software-carpentry.org/blog/2017/02/inclusion.html">inclusive as possible</a>.</li>
</ul>
<h3>What's happening at the University?</h3>
<p>The University is now a Software Carpentry Partner Organisation so can run many workshops per year using the Software Carpentry and Data Carpentry branding.  We could run workshops without the branding but Software and Data Carpentry are now familiar names to researchers (and potentially employers) and by working closely with those two organisations we become part of a global network of instructors with which we can share ideas and materials.</p>
<p>The RSE team and Library collectively now have five accredited Software and Data Carpentry instructors: Mike Croucher received training some time ago and in March Tania Allard and I from the <a href="http://rse.shef.ac.uk/contact/">RSE team</a> plus <a href="https://www.sheffield.ac.uk/library/libstaff/researchservices">Jez Cope and Beth Hellen</a> from the Library's Research Services Unit participated in <a href="https://steve-crouch.github.io/2017-03-16-oxford-ttt/">instructor training in Oxford</a>.  </p>
<p><img alt="Software Carpentry Instructor Training session" src="../images/soft-carp-instructor-training.jpg"></p>
<p>The four of us spent two days learning about the SC/DC teaching style, what makes for an effective instructor and got to practise several aspects of workshop development and delivery.  I must thank the instructors on the training course (Mateuz Kuzak and Steve Crouch) plus <a href="https://rroxford.github.io/">Reproducible Research Oxford</a> for hosting and organising the event.</p>
<p>We are now planning our first Software Carpentry and Data Carpentry workshops.  These are to be held later in the summer.  </p>
<p><strong>Keep an eye on this blog, the <code>RSE-group@sheffield.ac.uk</code> mailing list and <a href="https://www.twitter.com/rse_sheffield">@RSE_Sheffield</a> for dates!</strong></p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="coffee-and-cakes-event-2nd-after/" class="u-url">Coffee and Cakes Event</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="../authors/twin-karmakharm/">Twin Karmakharm</a>
            </span></p>
            <p class="dateline"><a href="coffee-and-cakes-event-2nd-after/" rel="bookmark"><time class="published dt-published" datetime="2017-06-01T15:12:12+01:00" title="2017-06-01 15:12">2017-06-01 15:12</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>The RSE Sheffield team would like to thank everyone for attending the second Coffee and Cakes Event that was held last Wednesday (31/05/2017). The event provided a great opportunity to hear from researchers all around the University about the software engineering challenges faced within their projects. We hope to use the insights gained from the event to help improve your research workflow in the future.</p>
<p><strong>To get updates on future RSE events, please join our</strong> <a href="https://groups.google.com/a/sheffield.ac.uk/forum/#!forum/gpucomputing">RSE Google Discussion Group</a>.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="2nd-gpu-seminar-amr/" class="u-url">First GPU Computing Seminar - Towards achieving GPU-native adaptive mesh refinement</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="../authors/twin-karmakharm/">Twin Karmakharm</a>
            </span></p>
            <p class="dateline"><a href="2nd-gpu-seminar-amr/" rel="bookmark"><time class="published dt-published" datetime="2017-06-01T14:00:00+01:00" title="2017-06-01 14:00">2017-06-01 14:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p><img alt="amr" src="../images/2017_05_30_gpu_seminar_amr.jpg"></p>
<p>We've kicked off our first GPU Computing group seminar this year with a talk by <strong>Ania Brown</strong> from Oxford e-Research Centre titled <strong>"Towards achieving GPU-native adaptive mesh refinement"</strong> on 30th of May 2017. Adaptive mesh refinement (AMR) is a method for reducing memory cost by varying the accuracy in each region to match the physical characteristics of the simulation, at the cost of increased data structure complexity. Ania described the optimisation and software challenges that need to be considered when implementing AMR on GPUs, based on her experience working on a GPU-native framework for stencil calculations on a tree-based adaptively refined mesh as part of her Master degree.</p>
<p>There's no offical GPU Computing talks in June but we highly recommend the upcoming talk <strong>"From Democratic Consensus to Cannibalistic Hordes: The Principles of Collective Animal Behaviour"</strong> by <strong>Prof. Iain Couzin</strong> on the <strong>29th of June 2017</strong>.</p>
<h3>Links and More Information</h3>
<p>For presentation slides and more information on both of these talks, visit the <a href="http://gpucomputing.shef.ac.uk/seminars/">GPU Computing seminars</a> page.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="research_software_engineer_in_high_performance_computing/" class="u-url">Research Software Engineer in High Performance Computing</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="../authors/paul-richmond/">Paul Richmond</a>
            </span></p>
            <p class="dateline"><a href="research_software_engineer_in_high_performance_computing/" rel="bookmark"><time class="published dt-published" datetime="2017-05-22T18:30:00+01:00" title="2017-05-22 18:30">2017-05-22 18:30</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>A job opportunity within the RSE Sheffield group is available under the job title of "Research Software Engineer in High Performance Computing (HPC) enabled Multi-Scale Modelling".</p>
<p>The purpose of the Research Software Engineer post is to enhance The University’s capability and expertise in developing Research Software. This role will be based in the newly formed <a href="http://rse.shef.ac.uk/">Research Software Engineering group</a>, which aims to improve all aspects of research software including reproducibility, usability, efficiency and correctness.</p>
<p>The primary function of this role is to support the EC funded CompBioMed project. A user-driven Centre of Excellence in Computational Biomedicine, to nurture and promote the uptake and exploitation of high performance computing within the biomedical modelling community. </p>
<p>The post is fixed-term with an end date of 30 September 2019. The deadline for applications is 19th June 2017.</p>
<h3>Links and More Information</h3>
<p><a href="http://www.jobs.ac.uk/job/BBN749/research-software-engineer-in-high-performance-computing-hpc-enabled-multi-scale-modelling/">Jobs.ac.uk posting</a></p>
<p><a href="https://jobs.shef.ac.uk/sap/bc/webdynpro/sap/hrrcf_a_posting_apply?PARAM=cG9zdF9pbnN0X2d1aWQ9MzMwNjJBRkQ4MDQ5MUVFNzhGOEY4MkE0ODgzRjg4MEYmY2FuZF90eXBlPUVYVA%3d%3d&amp;sap-client=400&amp;sap-language=EN&amp;sap-accessibility=X&amp;sap-ep-themeroot=%2fSAP%2fPUBLIC%2fBC%2fUR%2fuos#">University of Sheffield Application Link</a></p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="sheffield-code-firstgirls/" class="u-url">Sheffield Code First:girls</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="../authors/tania-allard/">Tania Allard</a>
            </span></p>
            <p class="dateline"><a href="sheffield-code-firstgirls/" rel="bookmark"><time class="published dt-published" datetime="2017-05-18T09:32:49+01:00" title="2017-05-18 09:32">2017-05-18 09:32</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p><img alt="python1" src="../images/CF_python1.jpg"></p>
<p>Anyone working on any STEM area knows, as a fact, that we are facing a digital and technical skills gap.  In the governement's digital strategy <a href="http://www.bbc.co.uk/news/business-36510266">report</a> last year it
was highlighted that we would need an extra 745,000 workers with digital skills by 2017, as 90% of jobs require digital skills to some degree.
On top of this, many technical areas suffer a diversity deficit (cultural and gender based).
With the UK being among the European countries with the smaller number of female
professionals in STEM areas.</p>
<p>Being this a rather complex problem, many people and organisations work hard to provide a solution to this issue.  Some approaches adopted by such individuals and organisations are:</p>
<ul>
<li>Encourage the hiring of highly skilled immigrants</li>
<li>Provide wider support for underrepresented minorities</li>
<li>Leverage inclusive and encouraging environments for those who
demonstrate an interest in STEM areas</li>
<li>Support and train those willing to make a career change/or follow non-traditonal career paths</li>
<li>Approach the new generations and provide them with useful skills that would help them
make an informed career choice</li>
</ul>
<p>... and the list goes on.</p>
<p>I do believe, however, that the most fruitful approach is to work with the upcoming generations and provide them with useful technical and personal skills early on. This would not only make them better qualified for their future but would enable them to make informed decisions with regards to their professional future.</p>
<p><a href="http://www.codefirstgirls.org.uk">Code First: girls</a> is a multi-award organization that aims to tackle the gender imbalance in three ways: training women, building a strong and supportive community, and helping companies to train, recruit, and retain their female force.</p>
<p>Belonging to a minority within STEM has lead me to take an active role as an equality and diversity ambassador, which eventually lead me to volunteer as a Python instructor for the Code First courses.</p>
<p>Over the course of 8 weeks we teach and guide groups of around 30 women with various levels of coding experience in CSS/HTML, Python, or Ruby. These courses are a mixture of in-person classes and self-learning, at the same time the ladies involved work in teams of 2-4 people to build a project of their own interest.</p>
<p><img alt="python1" src="../images/CF_python3.jpg"></p>
<p>The idea behind these workshops is rather simple: train people and provide them with practical use of the skills they are learning. Having as a final objective to develop a fully deployed RESTful app. But the whole CF:girls thing goes way beyond that. Over those 8 weeks the girls form a strong, motivating, and supportive community, in which they can acquire new skills, meet like-minded people, learn from other women working in STEM areas, and even attend external women in tech events!</p>
<p><img alt="python1" src="../images/CF_python2.jpg"></p>
<p>I find rather interesting the mixture of apps and projects pursued, as well as the high quality of the presented final products. But beyond that, I find this to be an excellent opportunity to give back to the amazing community that has adopted and welcome me as a professional in a STEM area. Thus I can say for sure I will be getting involved in more Code First events/workshops.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="coffee-and-cakes-event-2nd/" class="u-url">Coffee and Cakes Event</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="../authors/mozhgan-kabiri-chimeh/">Mozhgan Kabiri Chimeh</a>
            </span></p>
            <p class="dateline"><a href="coffee-and-cakes-event-2nd/" rel="bookmark"><time class="published dt-published" datetime="2017-05-17T12:12:12+01:00" title="2017-05-17 12:12">2017-05-17 12:12</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>RSE Sheffield is hosting another coffee and cakes event on <strong>May 31st at 14:00 in the Ada Lovelace room</strong> on 1st floor of the Computer Science Department (Regents Court East). Attendance is free, but you need to register via <a href="https://goo.gl/forms/L2dRQNvSUvkIbtSm2">this link</a>.</p>
<p>Take the opportunity to come and have an informal chat about research software.</p>
<p>This event is a community event for anyone, not just computer science or members of the RSE team. If you work on software development are an RSE or simply want to talk about some aspect of software or software in teaching then come along.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="building-linux-gpu-code-with-nsight-in-windows/" class="u-url">Building Linux GPU Code with NSIGHT in Windows</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="../authors/paul-richmond/">Paul Richmond</a>
            </span></p>
            <p class="dateline"><a href="building-linux-gpu-code-with-nsight-in-windows/" rel="bookmark"><time class="published dt-published" datetime="2017-05-08T16:03:00Z" title="2017-05-08 16:03">2017-05-08 16:03</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Why would you possibly want to build and execute CUDA GPU applications within NSight Eclipse for Linux within Microsoft Windows? Well if you use windows as your main OS there are plenty of reasons but the most obvious is that you may be developing cross platform code and want to build and test it without dual booting. If you are thinking about virtual machines then forget about it. Most (except some very expensive enterprise options) do not have the ability to access a GPU device (e.g GPU pass-through) from within a virtual machine. </p>
<p>The purpose of this post is to describe how to install the necessary tools to permit local GPU development inside the Linux NSight IDE from within Windows. The advantages of which are not only cross platform development but also the ability to locally develop in powerful Linux IDE with remote execution and graphical debugging. This is particularly helpful if you want to execute or debug your code on a HPC system (like Sheffield's ShARC system) from Windows. The post focuses on the use of the new Windows 10 Linux subsystem, however you could use the approach to install CUDA tools on a lightweight Linux virtual machine. The concept is the same either way. i.e. build and debug locally execute remotely.</p>
<h3>Configuring the Linux Windows Subsystem for CUDA compilation</h3>
<p>The Windows 10 subsystem for Linux is available in the anniversary update. You can install it from the "Turn on or off windows features" dialogue. It is listed under "Windows subsystem for Linux (beta)". This alone is not enough to build our GPU applications as we will need to install CUDA. A normal CUDA install will require a local GPU and the installation of a CUDA compatible graphics driver. Fire up the Windows Bash Shell (or a Linux virtual machine). You can then use the following commands to install the CUDA toolkit without installing a graphics driver. This will install the core NVIDIA CUDA compiler (nvcc) and NSight. You can update the <code>CUDA_REPO_PKG</code> variable to install a different CUDA version.</p>
<pre class="code literal-block"><span></span>sudo apt-get update
CUDA_REPO_PKG=cuda-repo-ubuntu1404_8.0.44-1_amd64.deb
wget http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1404/x86_64/$CUDA_REPO_PKG
sudo dpkg -i $CUDA_REPO_PKG
sudo apt-get update
sudo apt-get install -y --no-install-recommends cuda-core-8-0 cuda-cudart-dev-8-0 nsight
</pre>


<p>You can now create a symbolic link to a generic CUDA install. This will permit the addition and fast swapping of different CUDA versions.</p>
<pre class="code literal-block"><span></span>sudo ln -s /usr/local/cuda-8.0 /usr/local/cuda 
export PATH=$PATH:/usr/local/cuda/bin
</pre>


<p>Note: if you want the CUDA bin location to be persistently on the PATH (after you reboot the Bash shell) then you will need to add the <code>export PATH</code> line to your .bashrc profile. Test that the install was successful by running nvcc.</p>
<pre class="code literal-block"><span></span>nvcc --version
</pre>


<p>This should give you some information on the nvcc version. e.g. </p>
<pre class="code literal-block"><span></span><span class="n">nvcc</span><span class="o">:</span> <span class="n">NVIDIA</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="n">Cuda</span> <span class="n">compiler</span> <span class="n">driver</span>
<span class="n">Copyright</span> <span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="mi">2005</span><span class="o">-</span><span class="mi">2016</span> <span class="n">NVIDIA</span> <span class="n">Corporation</span>
<span class="n">Built</span> <span class="n">on</span> <span class="n">Tue_Jan_10_13</span><span class="o">:</span><span class="mi">22</span><span class="o">:</span><span class="mi">03</span><span class="n">_CST_2017</span>
<span class="n">Cuda</span> <span class="n">compilation</span> <span class="n">tools</span><span class="o">,</span> <span class="n">release</span> <span class="mf">8.0</span><span class="o">,</span> <span class="n">V8</span><span class="o">.</span><span class="mf">0.61</span>
</pre>


<p>The CUDA toolkit is now installed so you can build (but not execute) CUDA GPU programs using the Linux bash shell.</p>
<h3>Graphical editing with Nsight IDE</h3>
<p>To be able to run a graphical NSight IDE from within the Windows subsystem for Linux you will need to be running a X server within Windows. You can install the <strong>free</strong> <a href="https://sourceforge.net/projects/xming/">XMing</a> application for this purpose. If you would rather use a Linux virtual machine then you can avoid this step as the virtual machine will most likely have an X server included. The advantage of the Windows subsystem approach is that it is very lightweight. From within your Bash terminal you will need to set the following environment variable.</p>
<pre class="code literal-block"><span></span>export DISPLAY=:0
</pre>


<p>The display variable is an environment variable passed to graphical applications. In this case, the value of <code>:0</code> it tells the application to use the first display on the local system (our XMing server in this case). If you want to make this environment variable change permanent then you should add it to your .bashrc profile. You can now run the NSight application from Bash.</p>
<pre class="code literal-block"><span></span>nsight
</pre>


<p>Glorious isn't it. Within NSight we can create a new CUDA project which will compile using the local CUDA install. In order to remotely execute and debug you can use the "C++ Remote application" run configuration. This will require SSH access to a suitable Linux machine with a GPU and CUDA installed.</p>
<p>Future blog posts will cover how remote execution and debugging can be achieved on the University of Sheffield ShARC system. ShARC has a typical of job based HPC system which encourages job submission rather than execution of code on worker nodes via SSH logins. </p>
<h3>Summary of Bash Profile Changes</h3>
<p>I added the following to my .bashrc profile (located in the home directory) to ensure that NSight could be launched straight after starting the Bash shell in Windows.</p>
<pre class="code literal-block"><span></span># add cuda bin dir to path
export PATH=$PATH:/usr/local/cuda/bin

# export the display environment variable
export DISPLAY=:0
</pre>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="spark-scala-sheffield-hpc/" class="u-url">Spark and Scala on Sheffield HPC systems</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="../authors/mike-croucher/">Mike Croucher</a>
            </span></p>
            <p class="dateline"><a href="spark-scala-sheffield-hpc/" rel="bookmark"><time class="published dt-published" datetime="2017-05-08T11:17:05Z" title="2017-05-08 11:17">2017-05-08 11:17</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>As part of our support for a Large scale machine learning MSc course in Computer Science, the Sheffield RSE group put together a tutorial for how to use <a href="http://spark.apache.org/">Spark</a> and Scala on <a href="http://docs.hpc.shef.ac.uk/en/latest/">Sheffields HPC systems</a>.
We are sharing with the rest of the community in case its useful to you <a href="https://github.com/mikecroucher/Intro_to_HPC/blob/gh-pages/README.md">https://github.com/mikecroucher/Intro_to_HPC/blob/gh-pages/README.md</a> </p>
<p>Its for people whove never used a HPC system before. By the time theyve finished, they are able to submit their own Spark jobs to the HPC cluster.
If anyone is interested in us re-running this as a workshop (it takes around 2 hours) let us know.</p>
<p>Some notes on our current implementation of Spark on HPC:-</p>
<ul>
<li>
<p>We are currently restricted to jobs that run on one node. This is because Sheffields HPC clusters are not traditional Hadoop/Spark clusters and so some level of integration is required between Sun Grid Engine and Spark. We've only managed to get as far as implementing this across single nodes at the moment.</p>
</li>
<li>
<p>One way weve fudged this is to make sure that we provide our students with access to nodes with a LOT of memory  768 GB per node in fact, 12 times as much as you get on a normal node on ShARC or Iceberg. We are experimenting with allowing others access to our kit via a contribution based model. See <a href="http://rse.shef.ac.uk/resources/hpc/premium-hpc">http://rse.shef.ac.uk/resources/hpc/premium-hpc/</a> for details.</p>
</li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="sge-job-validation-2/" class="u-url">Job validation with Grid Engine: false negatives</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="../authors/will-furnass/">Will Furnass</a>
            </span></p>
            <p class="dateline"><a href="sge-job-validation-2/" rel="bookmark"><time class="published dt-published" datetime="2017-04-19T10:15:00Z" title="2017-04-19 10:15">2017-04-19 10:15</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>In <a href="sge-job-validation">a previous post</a>, 
I noted that if you're not sure if a Sun Grid Engine (SGE) job can ever run on an <a href="https://en.wikipedia.org/wiki/Supercomputer">HPC cluster</a>
you can perform 'dry-run' job validation:
by passing <code>-w v</code> as arguments to <code>qrsh</code>/<code>qrshx</code>/<code>qsh</code>/<code>qalter</code> you can ask the SGE scheduler software 
if your job could ever run if the cluster were entirely empty of other jobs.</p>
<p>For example:</p>
<pre class="code literal-block"><span></span>    qsub -pe smp 2 -l rmem=10000G -w v myjob.sge
</pre>


<p>would most likely tell you that your job could not be run in any of the cluster's job queues 
(due to the size of the resource request).</p>
<p><strong>But beware:</strong> 
as mentioned in my earlier post 
this his job validation mechanism sometimes results in <em>false negatives</em> i.e. you are told that a job cannot run even though though in reality it can.<br>
This is something that the HPC sysadmin team at the University of Leeds alerted us to.</p>
<p>Here's an example of a false positive (using our <a href="https://docs.hpc.shef.ac.uk/en/latest/sharc/">ShARC</a> cluster.<br>
If you ask for a single-core interactive session with access to four GPUs then dry-run validation fails:</p>
<pre class="code literal-block"><span></span>    [te1st@sharc-login1 ~]$ qrsh -l gpu=4 -w v
    ...
    verification: no suitable queues
</pre>


<p>yet (without validation) the resource request can be satisfied:</p>
<pre class="code literal-block"><span></span>    [te1st@sharc-login1 ~]$ qrsh -l gpu=4 
    [te1st@sharc-node100 ~]$   # works!
</pre>


<p>The <strong>reason for this</strong> appears to be that the validation is performed 
without running any <a href="http://gridscheduler.sourceforge.net/htmlman/htmlman1/jsv.html">Job Submission Verifier</a> (JSV) scripts.
These scripts are run (typically on the SGE master machine) on every submitted job to 
centrally modify or reject job requests post-submission.</p>
<p>On ShARC the main JSV script changes a job's <a href="http://gridscheduler.sourceforge.net/htmlman/htmlman5/project.html?pathrev=V62u5_TAG">Project</a> 
from a generic one 
to <code>gpu</code> 
if <code>x &gt; 0</code> GPUs have been requested using <code>-l gpu=x</code>.
The job can then be assigned to (GPU-equipped) nodes associated with that project.
So, if the JSV is not run before job validation (using <code>-w v</code>) then 
validation of jobs that request GPUs will fail as 
no nodes (more accurately <em>queue instances</em>) will be found that can satisfy the resource request 
given the (default) project of jobs.  </p>
<p>The workaround here is to explicitly request a Project (using e.g. <code>-P gpu</code>) 
when trying to validate a job using <code>-w v</code> 
i.e. partly duplicate the logic in the (bypassed) JSV,
but this requires that you know have read and understood the JSV.<br>
This is something that users may not want to do and adds complexity, 
when the whole point of investigating job validation in the first place was to 
find a simple way by which users could check if if their jobs could run on a given SGE cluster.</p>
<p>In summary, SGE's job validation mechanism is not a fool-proof option for users as 
it does not take into consideration changes made to a job by Job Submission Verifier scripts post-submission.</p>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-3.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:rse@sheffield.ac.uk">Mike Croucher and Paul Richmond</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
